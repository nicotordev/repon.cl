(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{191:(e,r,t)=>{Promise.resolve().then(t.bind(t,3512))},3512:(e,r,t)=>{"use strict";t.d(r,{VoiceButton:()=>E});var s,a=t(6409),n=t(4669),i=t(1736),o=t(278),u=t(268),l=t(786),c=t(1754),d=t(5040);function p(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,d.QP)((0,c.$)(r))}let v=(0,u.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",xs:"h-6 gap-1 rounded-md px-2 text-xs has-[>svg]:px-1.5 [&_svg:not([class*='size-'])]:size-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-xs":"size-6 rounded-md [&_svg:not([class*='size-'])]:size-3","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function g(e){let{className:r,variant:t="default",size:s="default",asChild:n=!1,...i}=e,o=n?l.bL:"button";return(0,a.jsx)(o,{"data-slot":"button","data-variant":t,"data-size":s,className:p(v({variant:t,size:s,className:r})),...i})}var f=t(2803);function b(e){let{className:r,...t}=e;return(0,a.jsx)(f.A,{role:"status","aria-label":"Loading",className:p("size-4 animate-spin",r),...t})}let m=null!=(s=t(7654).env.NEXT_PUBLIC_API_URL)?s:"http://localhost:4000",h="".concat(m,"/api/v1/chat/voice"),R={state:"IDLE",error:null,result:null};function x(e){switch(e){case"IDLE":return"Mantener para hablar";case"RECORDING":return"Soltar para enviar";case"PROCESSING":return"Procesandoâ€¦";case"RESPONDING":return"Listo";case"ERROR":return"Reintentar";default:return""}}function E(e){let{className:r}=e,{state:t,error:s,result:u,startRecording:l,stopRecording:c,reset:d}=function(){let[e,r]=(0,n.useState)(R),t=(0,n.useRef)(null),s=(0,n.useRef)(null),a=(0,n.useRef)([]),i=(0,n.useCallback)(()=>{t.current&&(t.current.getTracks().forEach(e=>e.stop()),t.current=null)},[]),o=(0,n.useCallback)((e,t)=>{r(r=>{var s;return s={state:e,...t},{...r,...s}})},[]),u=(0,n.useCallback)(async()=>{if("IDLE"===e.state)try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});t.current=e,a.current=[];let r=("undefined"==typeof MediaRecorder?"":MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"")||void 0,n=new MediaRecorder(e,r?{mimeType:r}:void 0);n.ondataavailable=e=>{e.data.size>0&&a.current.push(e.data)},n.start(100),s.current=n,o("RECORDING",{error:null,result:null})}catch(e){o("ERROR",{error:e instanceof Error?e.message:"No se pudo acceder al micr\xf3fono"})}},[e.state,o]),l=(0,n.useCallback)(async()=>{if("RECORDING"!==e.state||!s.current)return;let r=s.current;return s.current=null,i(),new Promise(e=>{r.onstop=async()=>{let t=a.current.length>0?new Blob(a.current,{type:r.mimeType||"audio/webm"}):null;if(a.current=[],!t||0===t.size){o("IDLE",{error:null,result:null}),e();return}o("PROCESSING");try{let r=new FormData;r.append("audio",t,"recording.webm");let s=await fetch(h,{method:"POST",body:r,credentials:"include"}),a=await s.json();if(!s.ok){let r="error"in a?a.error:"Error en el servidor";o("ERROR",{error:r}),e();return}let n="transcript"in a?{transcript:a.transcript,response:a.response}:{transcript:"",response:""};o("RESPONDING",{result:n,error:null})}catch(e){o("ERROR",{error:e instanceof Error?e.message:"Error de red"})}e()},"recording"===r.state?r.stop():e()})},[e.state,i,o]),c=(0,n.useCallback)(()=>{"RECORDING"===e.state&&s.current&&(s.current.stop(),s.current=null,i()),r(R)},[e.state,i]);return{state:e.state,error:e.error,result:e.result,startRecording:u,stopRecording:l,reset:c}}(),v=(0,n.useCallback)(e=>{e.preventDefault(),("IDLE"===t||"ERROR"===t)&&l()},[t,l]),f=(0,n.useCallback)(e=>{e.preventDefault(),"RECORDING"===t&&c()},[t,c]),m=(0,n.useCallback)(e=>{e.preventDefault(),"RECORDING"===t&&c()},[t,c]),E="RECORDING"===t,N="PROCESSING"===t,k="ERROR"===t;return(0,a.jsxs)("div",{className:p("flex flex-col items-center gap-3",r),children:[(0,a.jsx)(g,{type:"button",variant:k?"destructive":"default",size:"lg",className:p("touch-none select-none rounded-full size-14 transition-all",E&&"scale-110 bg-red-600 hover:bg-red-600"),onMouseDown:v,onMouseUp:f,onMouseLeave:m,onTouchStart:e=>{e.preventDefault(),("IDLE"===t||"ERROR"===t)&&l()},onTouchEnd:e=>{e.preventDefault(),"RECORDING"===t&&c()},disabled:N,"aria-label":x(t),"aria-busy":N,children:N?(0,a.jsx)(b,{className:"size-6"}):E?(0,a.jsx)(i.A,{className:"size-6 fill-current"}):(0,a.jsx)(o.A,{className:"size-6"})}),(0,a.jsx)("span",{className:p("text-sm text-muted-foreground",k&&"text-destructive"),role:"status",children:null!=s?s:x(t)}),u&&(u.transcript||u.response)&&(0,a.jsxs)("div",{className:"w-full max-w-md space-y-2 rounded-lg border bg-muted/50 p-3 text-sm",children:[u.transcript&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-muted-foreground",children:"T\xfa: "}),u.transcript]}),u.response&&(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium text-muted-foreground",children:"Respuesta: "}),u.response]}),(0,a.jsx)(g,{variant:"ghost",size:"sm",onClick:d,children:"Nueva grabaci\xf3n"})]})]})}}},e=>{e.O(0,[730,429,597,358],()=>e(e.s=191)),_N_E=e.O()}]);